{% extends "base.html" %}

{% block title %}: {{ data.preferred_name }}{% endblock %}

{% block js %}
<script type="text/javascript" src="{{ STATIC_URL }}function/topic.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}function/facets.js"></script>
{% endblock %}

{% block css %}
<link rel="stylesheet" href="{{ STATIC_URL }}style/topic.css" type="text/css"/>
<link rel="stylesheet" href="{{ STATIC_URL }}style/facets.css" type="text/css" />
{% endblock %}

{% block content %}

    <header>
      <h2 id="topic-name">{{ data.preferred_name }}</h2>
      <div class="related-topics">
        {% if data.related_topics.all %}
        <span class="quiet">Related topics:</span> 
        <ul class="topic-list">
          {% for related_topic in data.related_topics %}
          <li>{{ related_topic.topic }}{% if not forloop.last %} | {% endif %}</li>
          {% endfor %}
        </ul>
        {% endif %}
      </div>
    </header>

    <ul id="tabs" class="nav nav-tabs">
      <li class="active"><a href="#article-tab" data-toggle="tab">Article</a></li>
      <li><a href="#notes-tab" data-toggle="tab">Related Notes <span class="alt">&amp;</span> Queries ({{ notes|length }})</a></li>
      <li><a href="#documents-tab" data-toggle="tab">Related Documents ({{ documents|length }})</a></li>
    </ul>

    <div class="tab-content">
      <section id="article-tab" class="tab-pane active">
        <article id="{{ data.slug }}-summary" class="note">
          {% if data.has_summary %}
          <div class="note-content">
            {{ data.summary|as_html }}
          </div>
          {% else %}
          <div>
            There is no article about <em>{{ data.preferred_name }}</em> yet.
          </div>
          {% endif %}
          {% if data.summary_cites.all %}
          <h4>Sources</h4>
          <div class="citation-list">
            {% for cite in data.summary_cites.all %}
              {% include "citation.include" %}
            {% endfor %}
          </div>
          {% endif %}
          <div class="row edit-row">
            <div class="span6 edit-button">
              {% if request.user.is_authenticated %}
              <a class="btn" href="{{ data.get_admin_url }}?return_to={{ data.get_absolute_url }}">Edit</a>
              {% endif %}
            </div>
            <div class="span6 edit-history">
              {# {{ topic|display_edit_history }} #}
            </div>
          </div>
        </article>
      </section>

      <section id="notes-tab" class="tab-pane">
        {% if notes %}
          {% for note, note_topics in notes %}
          <div id="note-{{ note.id }}" class="related-note">
            <div class="note-link">
              {{ note|as_link }}
            </div>
            <div class="note-last-modified">
              <span class="quiet">Last modified: </span><span>{{ note.last_updated }}</span>
            </div>
            {% if note_topics|length %}
            <div class="note-topics">
              <span class="quiet">Related topics: </span>
              <ul class="topic-list unstyled">
                {% for topic in note_topics %}
                <li><a href="{{ data.url }}">{{ data.preferred_name }}</a> {% if not forloop.last %} | {% endif %}</li>
                {% endfor %}
              </ul>
            </div>
            {% endif %}
          </div>
          {% endfor %}
        {% else %}
          There are no notes or queries related to <em>{{ data.preferred_name }}</em>.
        {% endif %}
      </section>

      <section id="documents-tab" class="tab-pane">
        {% if documents %}
        <ul id="document-list" class="model-list unstyled">
          {% for document in documents %}
          <li class="document-list-item">
            {{ document|as_link|typogrify }}
          </li>
          {% endfor %}
        </ul>

        {% else %}
          There are no documents related to <em>{{ data.preferred_name }}</em>.
        {% endif %}
      </section>
    </div>
{% endblock %}
